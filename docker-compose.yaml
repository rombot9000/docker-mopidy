services:
  mopidy:
    environment:
      - EXPOSE_PORT=${EXPOSE_PORT}
      - PUBLISH_PORT=${PUBLISH_PORT}
    build:
      context: .
      tags:
        - "local/mopidy:latest"
      args:
        - EXPOSE_PORT=${EXPOSE_PORT}
    container_name: mopidy
    devices:
      - "/dev/snd"
    ports:
      - "${PUBLISH_PORT}:${EXPOSE_PORT}"
    post_start:
      - command: mopidy local scan
        user: root
    restart: "unless-stopped"
    volumes:
      - ~/.config/mopidy:/config
      - ~/.cache/mopidy:/cache
      - ~/.local/share/mopidy:/data
      - type: bind
        source: /srv/media/music
        target: /music
        read_only: true
